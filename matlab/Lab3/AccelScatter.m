% Define data points
XYZ = [
 13, -15, 995;
 12, -19, 996;
 4, -16, 995;
 4, 37, 988;
 0, -6, 985;
 -10, -56, 993;
 34, 90, 988;
 -12, 49, 932;
 -71, -50, 1007;
 32, 41, 1069;
 45, 49, 939;
 6, -14, 909;
 -25, 14, 1077;
 -25, -35, 1101;
 33, -125, 1050;
 35, -69, 1052;
 45, 23, 999;
 13, 39, 942;
 -38, 65, 949;
 -44, 80, 1019;
 -51, 54, 1034;
 -38, 57, 1037;
 -6, 43, 1060;
 8, 46, 1019;
 5, 79, 985;
 8, 95, 1019;
 22, 124, 985;
 35, 146, 970;
 55, 165, 950;
 66, 190, 973;
 60, 260, 1049;
 45, 291, 1033;
 37, 295, 1010;
 42, 306, 985;
 48, 374, 918;
 48, 421, 860;
 48, 463, 797;
 34, 510, 829;
 -9, 586, 751;
 -34, 609, 754;
 -75, 665, 747;
 -106, 715, 627;
 -128, 759, 560;
 -123, 774, 553;
 -105, 789, 575;
 -103, 798, 578;
 -105, 791, 553;
 -102, 780, 523;
 -116, 798, 459;
 -151, 890, 372;
 -181, 942, 256;
 -172, 918, 260;
 -163, 923, 298;
 -153, 923, 276;
 -129, 945, 218;
 -134, 952, 185;
 -168, 945, 129;
 -187, 924, 49;
 -225, 906, -29;
 -261, 896, -64;
 -314, 876, -166;
 -340, 856, -222;
 -382, 851, -332;
 -394, 828, -405;
 -391, 750, -499;
 -397, 717, -538;
 -404, 681, -535;
 -402, 658, -528;
 -415, 602, -597;
 -426, 610, -648;
 -417, 462, -718;
 -417, 348, -781;
 -421, 330, -857;
 -433, 309, -914;
 -439, 312, -910;
 -425, 315, -856;
 -420, 336, -863;
 -441, 369, -881;
 -464, 384, -887;
 -456, 373, -906;
 -430, 406, -861;
 -416, 396, -775;
 -358, 397, -578;
 -297, 496, -420;
 -234, 653, -201;
 -178, 686, -12;
 -92, 683, 270;
 -39, 651, 433;
 26, 608, 663;
 10, 709, 750;
 61, 651, 891;
 177, 461, 953;
 239, 336, 1018;
 279, 227, 1062;
 411, 40, 1086;
 492, -36, 1134;
 574, -111, 1151;
 544, -131, 970;
 477, -158, 856;
 482, -231, 868;
 470, -215, 763;
 431, -229, 700;
 423, -388, 641;
 438, -453, 648;
 401, -516, 675;
 368, -536, 686;
 396, -557, 648;
 446, -576, 725;
 482, -577, 790;
 459, -535, 798;
 378, -497, 883;
 314, -459, 889;
 293, -363, 770;
 298, -349, 706;
 303, -409, 837;
 299, -455, 911;
 239, -464, 810;
 203, -391, 793;
 193, -314, 835;
 205, -331, 856;
 175, -346, 833;
 134, -334, 883;
 60, -351, 916;
 -25, -379, 864;
 -151, -479, 968;
 -194, -685, 1063;
 -356, -827, 1122;
 -463, -765, 1058;
 -393, -729, 773;
 -386, -745, 602;
 -382, -632, 512;
 -330, -548, 444;
 -397, -684, 577;
 -451, -706, 518;
 -469, -639, 319;
 -443, -707, 285;
 -530, -740, 165;
 -636, -789, 148;
 -634, -878, -97;
 -602, -898, -86;
 -586, -965, 15;
 -590, -880, -135;
 -653, -779, -189;
 -678, -756, -197;
 -640, -662, -321;
 -635, -621, -410;
 -632, -615, -556;
 -587, -624, -591;
 -442, -521, -631;
 -408, -487, -614;
 -444, -524, -512;
 -456, -498, -383;
 -498, -583, -273;
 -580, -693, -207;
 -729, -904, -42;
 -733, -888, 17;
 -686, -678, 431;
 -705, -694, 598;
 -651, -690, 663;
 -633, -605, 775;
 -589, -465, 925;
 -508, -391, 1037;
 -420, -194, 1096;
 -306, -24, 1175;
 -159, 111, 1117;
 -108, 191, 973;
 -113, 488, 770;
 -133, 693, 608;
 -128, 858, 285;
 -37, 919, 42;
 69, 952, -77;
 70, 897, -73;
 73, 798, -222;
 33, 796, -366;
 3, 732, -518;
 -10, 667, -616;
 -72, 605, -716;
 -102, 538, -732;
 -134, 424, -793;
 -172, 360, -885;
 -244, 331, -902;
 -284, 296, -844;
 -399, 234, -819;
 -501, 238, -776;
 -597, 272, -621;
 -656, 288, -554;
 -781, 250, -536;
 -841, 193, -492;
 -904, 157, -481;
 -946, 105, -427;
 -965, -65, -235;
 -1008, -35, -130;
 -1056, 10, 79;
 -1024, -53, 197;
 -971, -117, 369;
 -947, -130, 434;
 -865, -169, 508;
 -741, -207, 600;
 -641, -222, 679;
 -606, -257, 744;
 -467, -264, 791;
 -392, -278, 780;
 -285, -390, 838;
 -216, -408, 882;
 -103, -417, 877;
 -16, -488, 801;
 90, -533, 823;
 162, -573, 878;
 268, -646, 796;
 357, -650, 735;
 491, -648, 728;
 551, -643, 702;
 582, -642, 583;
 610, -673, 526;
 660, -724, 462;
 668, -735, 424;
 653, -705, 242;
 611, -644, 116;
 637, -698, 228;
 682, -771, 311;
 700, -765, 213;
 725, -758, 146;
 730, -765, 140;
 680, -753, 154;
 608, -690, 58;
 587, -637, 35;
 627, -674, 90;
 650, -703, 90;
 660, -685, 87;
 681, -640, 103;
 687, -632, 112;
 638, -658, 83;
 614, -744, -13;
 660, -815, -63;
 684, -770, -68;
 670, -730, -165;
 700, -648, -370;
 759, -626, -374;
 698, -675, -381;
 589, -679, -462;
 480, -640, -496;
 449, -605, -529;
 436, -472, -675;
 432, -494, -691;
 413, -647, -643;
 398, -640, -647;
 401, -582, -692;
 383, -556, -736;
 314, -575, -762;
 301, -593, -733;
 340, -627, -707;
 359, -662, -732;
 368, -715, -718;
 386, -745, -632;
 391, -747, -519;
 383, -738, -414;
 400, -769, -312;
 426, -835, -295;
 448, -899, -61;
 413, -896, 160;
 330, -893, 324;
 299, -926, 281;
 267, -885, 443;
 221, -811, 598;
 136, -774, 677;
 55, -731, 732;
 -76, -672, 814;
 -153, -636, 871;
 -226, -597, 839;
 -281, -561, 808;
 -430, -465, 764;
 -544, -376, 779;
 -699, -296, 690;
 -753, -316, 599;
 -819, -349, 490;
 -872, -288, 365;
 -891, -184, 268;
 -895, -185, 184;
 -917, -222, -49;
 -906, -242, -188;
 -834, -311, -288;
 -842, -360, -241;
 -905, -364, -273;
 -893, -398, -390;
 -835, -457, -450;
 -790, -498, -504;
 -724, -509, -584;
 -676, -467, -635;
 -574, -444, -658;
 -504, -477, -670;
 -441, -533, -822;
 -409, -536, -847;
 -425, -518, -818;
 -477, -457, -836;
 -538, -393, -719;
 -548, -437, -592;
 -584, -481, -436;
 -597, -513, -398;
 -661, -561, -423;
 -764, -536, -333;
 -887, -478, -131;
 -959, -518, -171;
 -973, -556, -114;
 -934, -533, 107;
 -950, -510, 251;
 -943, -460, 322;
 -856, -442, 427;
 -753, -493, 487;
 -600, -504, 627;
 -545, -499, 649;
 -427, -524, 744;
 -311, -530, 807;
 -181, -556, 798;
 -117, -548, 826;
 17, -592, 874;
 82, -551, 885;
 161, -504, 882;
 214, -547, 864;
 277, -554, 812;
 333, -582, 761;
 429, -630, 675;
 441, -660, 638;
 521, -690, 523;
 622, -676, 430;
 680, -629, 314;
 717, -629, 268;
 761, -630, 203;
 765, -599, 144;
 773, -569, 83;
 783, -556, 51;
 733, -503, 3;
 741, -484, -77;
 799, -434, -213;
 822, -379, -301;
 878, -354, -397;
 894, -328, -393;
 921, -294, -403;
 903, -302, -408;
 792, -226, -556;
 704, -231, -664;
 814, -252, -767;
 861, -143, -783;
 579, 99, -693;
 419, 201, -718;
 382, 199, -700;
 431, 204, -713;
 456, 203, -775;
 464, 200, -811;
 480, 239, -885;
 473, 215, -909;
 477, 152, -1067;
 522, 130, -1059;
 613, 103, -814;
 652, 115, -753;
 727, 102, -646;
 780, 13, -502;
 828, -65, -263;
 845, -58, -74;
 878, -218, 219;
 894, -312, 313;
 709, -295, 402;
 502, -316, 683;
 360, -490, 1036;
 376, -580, 1036;
 293, -555, 822;
 194, -584, 606;
 85, -668, 421;
 109, -733, 301;
 326, -854, 327;
 501, -881, 479;
 705, -947, 321;
 649, -1022, 135;
 531, -1036, -29;
 518, -1053, -108;
 414, -1063, -240;
 280, -977, -382;
 73, -931, -488;
 -26, -895, -488;
 -64, -770, -634;
 -23, -656, -708;
 43, -487, -755;
 56, -412, -819;
 15, -314, -843;
 -57, -225, -953;
 -125, 58, -1102;
 -132, 98, -1019;
 -129, -27, -936;
 -93, 5, -975;
 67, -59, -928;
 115, -182, -935;
 47, -310, -976;
 33, -402, -930;
 21, -607, -840;
 92, -731, -734;
 304, -733, -477;
 408, -755, -349;
 452, -863, -209;
 457, -901, -117;
 554, -899, 116;
 564, -901, 351;
 471, -866, 570;
 431, -771, 763;
 405, -668, 924;
 353, -555, 883;
 244, -390, 895;
 198, -334, 900;
 136, -197, 996;
 121, -93, 1004;
 94, 28, 959;
 74, 66, 1034;
 18, 226, 962;
 -57, 430, 872;
 -121, 606, 751;
 -155, 673, 696;
 -177, 797, 553;
 -161, 824, 395;
 -130, 824, 322;
 -146, 874, 238;
 -224, 956, 26;
 -203, 954, -99;
 -187, 901, -157;
 -191, 836, -242;
 -155, 801, -424;
 -192, 829, -556;
 -238, 745, -699;
 -212, 650, -713;
 -180, 578, -829;
 -172, 534, -872;
 -159, 444, -842;
 -129, 349, -895;
 -97, 247, -983;
 -97, 178, -974;
 -92, 134, -997;
 -38, 170, -995;
 76, 214, -944;
 144, 213, -989;
 244, 204, -944;
 324, 179, -812;
 408, 280, -699;
 454, 424, -617;
 576, 488, -518;
 670, 451, -492;
 829, 366, -364;
 882, 309, -205;
 822, 314, 68;
 828, 283, 143;
 888, 260, 110;
 936, 246, 108;
 1001, 95, 71;
 958, -12, 171;
 936, -143, 290;
 964, -224, 232;
 806, -268, 395;
 660, -252, 666;
 550, -288, 888;
 493, -308, 885;
 435, -283, 891;
 357, -230, 928;
 223, -192, 1031;
 130, -155, 1090;
 -6, -98, 1052;
 -119, -71, 1007;
 -317, -22, 1156;
 -396, -48, 1118;
 -475, -84, 880;
 -667, -87, 755;
 -890, -142, 638;
 -859, -167, 557;
 -903, -221, 287;
 -979, -226, 121;
 -1029, -248, -59;
 -1026, -318, -108;
 -1014, -390, -182;
 -961, -371, -296;
 -824, -340, -528;
 -736, -337, -581;
 -538, -334, -662;
 -437, -356, -709;
 -449, -327, -794;
 -441, -342, -876;
 -291, -386, -947;
 -194, -346, -940;
 -157, -243, -767;
 -204, -217, -716;
 -258, -327, -832;
 -275, -374, -895;
 -333, -356, -847;
 -451, -360, -773;
 -792, -395, -481;
 -889, -502, -528;
 -803, -597, -681;
 -812, -551, -553;
 -892, -485, -390;
 -915, -391, -246;
 -924, -220, -47;
 -958, -169, 137;
 -981, -16, 351;
 -932, 35, 496;
 -830, 34, 705;
 -721, 172, 746;
 -484, 301, 750;
 -291, 336, 749;
 -71, 242, 950;
 7, 138, 1045;
 157, 103, 989;
 251, 75, 936;
 384, 45, 909;
 450, 28, 858;
 593, 8, 712;
 705, -35, 666;
 754, -68, 655;
 775, -72, 636;
 820, -87, 567;
 849, -85, 551;
 852, -77, 542;
 850, -76, 560;
 892, -71, 453;
 935, -71, 348;
 974, -58, 213;
 969, -32, 98;
 971, -14, 93;
 993, -28, 23;
 1008, -66, -114;
 1007, -63, -115;
 1029, -29, -114;
 1018, 5, -148;
 989, 71, -261;
 962, 82, -319;
 855, 81, -418;
 792, 100, -471;
 772, 116, -522;
 770, 121, -576;
 708, 120, -669;
 668, 131, -758;
 596, 164, -802;
 566, 176, -754;
 644, 158, -743;
 690, 150, -835;
 764, 288, -913;
 773, 328, -817;
 671, 207, -792;
 547, 143, -847;
 419, 94, -862;
 384, 90, -841;
 317, 144, -892;
 338, 146, -967;
 376, 108, -885;
 390, 125, -678;
 459, 145, -196;
 554, 132, 84;
 716, 71, 421;
 755, -8, 565;
 635, -89, 838;
 504, -103, 1124;
 271, -155, 1438;
 100, -184, 1502;
 -130, -164, 1277;
 -322, -129, 1062;
 -603, -150, 810;
 -729, -143, 708;
 -839, -137, 473;
 -835, -256, 345;
 -842, -386, 101;
 -878, -375, -144;
 -871, -384, -352;
 -839, -442, -471;
 -751, -475, -625;
 -603, -405, -669;
 -307, -366, -710;
 -189, -395, -803;
 -173, -413, -864;
 -248, -397, -839;
 -387, -369, -813;
 -461, -379, -710;
 -619, -445, -609;
 -687, -468, -567;
 -824, -457, -337;
 -971, -501, -208;
 -1052, -466, 100;
 -1035, -375, 193;
 -859, -288, 370;
 -701, -206, 658;
 -594, -86, 752;
 -498, -42, 814;
 -263, 84, 984;
 -108, 142, 978;
 165, 117, 897;
 364, 121, 820;
 572, 118, 797;
 645, 100, 804;
 761, 66, 656;
 822, 32, 539;
 884, 20, 452;
 893, 0, 399;
 824, 50, 193;
 839, 46, 42;
 984, -43, -215;
 1080, -103, -365;
 1098, -228, -375;
 993, -241, -358;
 855, -201, -440;
 802, -139, -563;
 691, -112, -684;
 608, -181, -711;
 525, -305, -833;
 533, -356, -868;
 505, -437, -821;
 456, -487, -671;
 415, -530, -517;
 452, -511, -605;
 427, -480, -835;
 347, -521, -882;
 282, -543, -790;
 256, -592, -729;
 266, -631, -756;
 244, -635, -767;
 259, -672, -826;
 251, -679, -846;
 224, -729, -619;
 205, -775, -540;
 228, -876, -409;
 306, -952, -249;
 328, -1131, -61;
 341, -1205, 31;
 401, -1147, 211;
 451, -1080, 447;
 472, -953, 662;
 439, -818, 787;
 369, -535, 1001;
 320, -362, 1040;
 244, -136, 976;
 135, 84, 888;
 -49, 286, 923;
 -149, 355, 850;
 -226, 516, 621;
 -249, 598, 520;
 -322, 690, 330;
 -354, 724, 172;
 -400, 731, -77;
 -424, 691, -225;
 -400, 605, -366;
 -394, 543, -464;
 -456, 468, -621;
 -513, 475, -675;
 -566, 461, -650;
 -590, 426, -590;
 -620, 332, -507;
 -649, 236, -495;
 -734, 113, -475;
 -784, 30, -283;
 -864, -65, -80;
 -1043, -116, -113;
 -1075, -229, 116;
 -934, -329, 282;
 -926, -399, 363;
 -899, -400, 499;
 -836, -287, 697;
 -799, -179, 781;
 -624, -121, 837;
 -442, -111, 825;
 -208, -81, 818;
 -158, -37, 862;
 -50, -106, 934;
 43, -146, 928;
 22, -69, 1049;
 53, -81, 1156;
 54, -143, 1146;
 2, -170, 1178;
 36, -130, 1188;
 71, -81, 1233;
 127, 42, 1138;
 89, 71, 996;
 -9, -38, 1021;
 -16, -72, 973;
 -39, -84, 1026;
 -78, -56, 1030;
 -71, -86, 900;
 -63, -153, 924;
 -44, -129, 976;
 12, -7, 1026;
 -31, 66, 977;
 -40, -51, 991;
 3, -134, 1048;
 40, -95, 1005;
 0, -66, 1009;
 -49, -89, 1001;
 -75, -59, 715;
 -170, 9, 845;
 -2, -20, 1309;
 94, 1, 1125;
 7, 36, 943;
 10, -11, 1009;
 11, -17, 992;
 13, -15, 986;
 12, -16, 996;
 11, -14, 996;
 11, -15, 999;
 13, -16, 996;
 11, -16, 996;
 11, -13, 989;
 13, -13, 991;
 11, -15, 997;
 10, -15, 995;
 10, -14, 994;
 10, -14, 993;
 10, -16, 995;
 10, -15, 999;
 11, -14, 998;
 13, -14, 997;
 13, -16, 997;
 12, -16, 995;
 13, -16, 995;
 11, -15, 996;
 12, -15, 996;
 13, -14, 995;
 11, -13, 995;
 10, -14, 992;
 9, -12, 993;
 10, -11, 994
];


% Separate column vectors
X = XYZ(:, 1);
Y = XYZ(:, 2);
Z = XYZ(:, 3);


[Atilde,Btilde] = CalibrateEllipsoidData3D(X,Y,Z,20,0);
[Xcorr,Ycorr,Zcorr] = CorrectEllipsoidData3D(X,Y,Z,Atilde,Btilde);

% Plot in 3D
scatter3(Xcorr, Ycorr, Zcorr);
xlabel('X');
ylabel('Y');
zlabel('Z');
title('Scatter Plot of XYZ Accelerometer Data');