% Define data points
XYZ = [
  0, 0, 0;
 -8, -2, 1;
 -18, -6, 6;
 -19, -12, 2;
 -19, -13, -4;
 -16, -9, -3;
 -17, -8, 4;
 -19, -5, 7;
 -20, -4, 1;
 -21, -3, 4;
 -21, -5, 4;
 -20, -10, 2;
 -17, -8, 2;
 -18, -8, -1;
 -19, -9, 0;
 -21, -8, -1;
 -18, -9, 0;
 -16, -11, 4;
 -14, -9, 6;
 -16, -9, 0;
 -19, -11, -4;
 -17, -13, 0;
 -20, -11, 7;
 -19, -10, 0;
 -15, -7, 0;
 -18, -13, 6;
 -20, -12, 5;
 -17, -5, 5;
 -15, -5, -1;
 -13, -10, -4;
 -15, -13, -1;
 -17, -15, -4;
 -16, -5, 0;
 -16, -8, 1;
 -20, -10, 0;
 -22, -11, 0;
 -16, -10, 2;
 -13, -6, 3;
 -17, -4, 0;
 -16, -5, -2;
 -16, -8, 3;
 -15, -5, 0;
 -19, -3, 0;
 -20, -2, 3;
 -18, -7, 5;
 -21, -7, -1;
 -17, -10, 4;
 -14, -10, 4;
 -13, -12, 3;
 -17, -15, 5;
 -21, -13, 3;
 -20, -10, 3;
 -18, -8, 0;
 -18, -8, 2;
 -19, -8, 0;
 -15, -7, -4;
 -17, -6, -1;
 -18, -11, 1;
 -19, -7, 7;
 -20, -8, 1;
 -17, -13, -1;
 -15, -11, 3;
 -15, -9, 2;
 -17, -9, 5;
 -15, -9, 4;
 -15, -7, 1;
 -16, 0, 6;
 -17, -8, 6;
 -16, -10, 8;
 -18, -7, 4;
 -19, -9, -1;
 -16, -10, -3;
 -15, -4, 0;
 -19, -6, 2;
 -18, -7, 0;
 -16, -8, -5;
 -19, -8, 2;
 -20, -4, 6;
 -18, -4, 3;
 -16, -4, 4;
 -16, -7, 2;
 -12, -7, 4;
 -14, -7, 7;
 -15, -10, 3;
 -17, -13, 2;
 -17, -6, -1;
 -18, -10, -4;
 -19, -9, -1;
 -17, -9, -4;
 -14, -9, 2;
 -16, -5, 3;
 -16, -8, 4;
 -14, -9, 3;
 -15, -4, 4;
 -18, -11, 9;
 -20, -14, 0;
 -20, -10, -2;
 -16, -13, 0;
 -14, -11, 4;
 -15, -9, 5;
 -15, -8, 5;
 -17, -7, 1;
 -16, -4, 2;
 -20, -6, 0;
 -17, -10, -5;
 -13, -7, 1;
 -15, -11, 1;
 -17, -13, 1;
 -18, -11, -4;
 -17, -12, 0;
 -17, -10, 0;
 -17, -9, 2;
 -17, -5, 2;
 -15, -7, 0;
 -14, -8, 2;
 -14, -10, 4;
 -19, -6, 3;
 -18, -8, 1;
 -17, -11, 0;
 -16, -10, 0;
 -14, -9, 1;
 -15, -7, 0;
 -19, -10, 0;
 -20, -13, 0;
 -21, -11, 0;
 -19, -12, 1;
 -19, -5, 7;
 -17, -11, 2;
 -19, -10, -2;
 -17, -6, 10;
 -15, -4, 5;
 -14, -5, 6;
 -18, -7, 0;
 -20, -11, 2;
 -20, -10, 4;
 -18, -9, 2;
 -17, -8, -4;
 -18, -8, -3;
 -17, -13, 3;
 -18, -10, 4;
 -15, -6, 8;
 -17, -8, 12;
 -16, -11, 6;
 -14, -16, -1;
 -17, -11, -1;
 -18, -8, 1;
 -18, -7, 3;
 -19, -6, 5;
 -19, -13, 3;
 -19, -11, 4;
 -18, -5, 4;
 -17, -7, 0;
 -18, -11, -3;
 -20, -15, 0;
 -18, -9, 3;
 -18, -13, 4;
 -18, -17, 5;
 -17, -14, 4;
 -14, -12, 1;
 -15, -5, 4;
 -17, -5, 1;
 -17, -9, 3;
 -18, -7, 0;
 -19, -6, -4;
 -15, -10, 0;
 -17, -9, 2;
 -17, -9, 5;
 -17, -11, 8;
 -15, -7, 9;
 -13, -3, 5;
 -20, -3, -1;
 -20, -7, -3;
 -16, -7, 0;
 -14, -3, 7;
 -15, -6, 6;
 -15, -6, 0;
 -19, -5, -2;
 -18, -9, 2;
 -20, -5, 2;
 -17, -9, 0;
 -17, -14, 6;
 -18, -14, 7;
 -16, -12, 6;
 -14, -9, 6;
 -14, -10, 1;
 -18, -9, 0;
 -15, -8, 2;
 -16, -6, 6;
 -14, -5, 4;
 -15, -9, 0;
 -18, -8, 3;
 -16, -5, 3;
 -17, -10, 1;
 -17, -11, 1;
 -17, -11, 0;
 -16, -12, 1;
 -20, -11, 0;
 -18, -9, -3;
 -15, -5, 0;
 -17, -8, 1;
 -15, -14, -3;
 -19, -9, -3;
 -19, -5, 2;
 -17, -9, 1;
 -13, -7, 0;
 -16, -9, 0;
 -16, -9, -3;
 -15, -7, 1;
 -15, -13, 1;
 -16, -14, 0;
 -17, -9, 5;
 -18, -6, 1;
 -18, -6, 2;
 -17, -5, 5;
 -17, -11, 4;
 -18, -14, 1;
 -17, -11, 2;
 -18, -11, 3;
 -20, -12, 4;
 -21, -3, -2;
 -19, -1, -2;
 -19, -6, 1;
 -16, -9, -1;
 -19, -11, -3;
 -23, -12, 4;
 -19, -6, 2;
 -18, -7, 0;
 -17, -7, 3;
 -15, -8, 7;
 -16, -9, 3;
 -15, -11, 2;
 -13, -7, 5;
 -17, -6, 5;
 -18, -8, 3;
 -17, -14, 6;
 -15, -8, 7;
 -15, -7, 6;
 -15, -15, 2;
 -19, -14, 0;
 -19, -10, 0;
 -15, -9, 5;
 -14, -9, 3;
 -17, -12, -1;
 -19, -5, -7;
 -16, -6, -5;
 -14, -8, 0;
 -14, -9, 7;
 -18, -9, 4;
 -16, -8, 0;
 -17, -7, 1;
 -18, -9, 6;
 -17, -11, 4;
 -19, -8, 5;
 -18, -10, 0;
 -17, -11, -5;
 -17, -8, -4;
 -16, -8, 0;
 -17, -11, 0;
 -17, -12, -3;
 -17, -6, -2;
 -22, -9, -5;
 -20, -12, -2;
 -19, -13, 5;
 -19, -12, 3;
 -15, -11, 3;
 -16, -10, -3;
 -17, -13, -5;
 -16, -6, 3;
 -18, -5, 5;
 -17, -8, 3;
 -18, -8, 0;
 -17, -16, 0;
 -16, -11, 2;
 -19, -10, 4;
 -18, -11, 0;
 -15, -9, 0;
 -14, -8, 0;
 -15, -9, 0;
 -17, -8, 0;
 -18, -8, 2;
 -16, -17, 3;
 -20, -16, -1;
 -18, -9, 2;
 -16, -7, 3;
 -16, -7, 1;
 -16, -8, -1;
 -15, -8, 0;
 -14, -10, 7;
 -15, -14, 0;
 -17, -12, -2;
 -18, -11, 6;
 -18, -11, 1;
 -19, -11, -1;
 -19, -11, 2;
 -20, -11, 5;
 -18, -12, 3;
 -17, -5, 1;
 -17, -2, 4;
 -19, -8, 5;
 -18, -15, 1;
 -16, -12, 2;
 -17, -8, -3;
 -17, -11, 0;
 -14, -9, 3;
 -15, -9, -1;
 -15, -12, -2;
 -14, -10, 4;
 -18, -8, 9;
 -22, -8, 5;
 -17, -9, 0;
 -17, -9, -1;
 -18, -10, -1;
 -16, -9, -5;
 -14, -12, -5;
 -19, -10, 3;
 -20, -9, 2;
 -18, -13, 4;
 -15, -9, 5;
 -15, -11, 5;
 -19, -8, 3;
 -19, -5, 1;
 -18, -7, 7;
 -18, -7, 3;
 -21, -8, 0;
 -20, -7, -3;
 -16, -6, -3;
 -17, -10, -4;
 -19, -17, -1;
 -18, -13, 0;
 -17, -11, 0;
 -16, -14, 1;
 -20, -10, 3;
 -20, -12, 3;
 -20, -10, -2;
 -18, -7, 2;
 -18, -7, 7;
 -21, -5, 1;
 -16, -4, 0;
 -14, -9, 1;
 -16, -11, 2;
 -17, -7, 3;
 -15, -9, 1;
 -15, -10, -11;
 -16, -7, -3;
 -16, -6, 7;
 -18, -5, 4;
 -18, -5, 4;
 -14, -5, 4;
 -14, -5, 6;
 -13, -8, 9;
 -16, -6, 7;
 -18, -6, 5;
 -17, -8, 0;
 -14, -7, -1;
 -13, -8, 1;
 -15, -8, -4;
 -19, -10, -3;
 -17, -7, 0;
 -17, -11, 8;
 -16, -12, 8;
 -17, -5, 1;
 -18, -8, 3;
 -21, -10, 3;
 -18, -8, 8;
 -17, -12, 12;
 -16, -13, 2;
 -17, -13, 0;
 -17, -9, 7;
 -17, -5, 8;
 -13, -6, 4;
 -15, -10, 5;
 -15, -9, 3;
 -14, -8, 7;
 -16, -11, 4;
 -15, -6, 1;
 -13, -4, 0;
 -18, -8, -1;
 -21, -8, -4;
 -19, -13, -2;
 -20, -9, 1;
 -17, -4, -2;
 -17, -7, 1;
 -18, -12, 4;
 -17, -11, 5;
 -12, -8, 8;
 -16, -6, 0;
 -19, -7, 6;
 -16, -8, 2;
 -15, -8, 3;
 -15, -5, 5;
 -11, -5, 7;
 -16, -13, 9;
 -19, -10, 3;
 -16, -7, 1;
 -21, -10, -1;
 -20, -3, 0;
 -15, -10, 2;
 -15, -9, 5;
 -17, -6, 3;
 -18, -8, 4;
 -19, -9, 1;
 -18, -7, 4;
 -19, -11, 0;
 -20, -6, 4;
 -18, -1, 3;
 -16, -6, 3;
 -16, -5, 0;
 -19, -6, -2;
 -18, -3, 1;
 -16, -10, 3;
 -21, -14, -2;
 -17, -13, 4;
 -14, -11, 8;
 -17, -6, 4;
 -14, -5, 1;
 -15, -4, 5;
 -15, -6, 2;
 -15, -8, -1;
 -16, -6, 0;
 -18, -3, 2;
 -19, -8, 0;
 -19, -9, 1;
 -17, -5, 5;
 -16, -7, 5;
 -16, -6, 2
];


% Separate column vectors
X = XYZ(:, 1);
Y = XYZ(:, 2);
Z = XYZ(:, 3);


% Find average biases 
averageXbias = mean(X);
averageYbias = mean(Y);
averageZbias = mean(Z);
display(averageXbias);
display(averageYbias);
display(averageZbias);

% Initialize variables
integratedAngles = zeros(size(XYZ)); % Matrix to store integrated angles
currentAngles = zeros(1, 3); % Vector to store current angles


% Plot Bias Against Time
% Time vector (assuming 6-second intervals)
tMin = (0:6:(size(XYZ, 1)-1)*6) / 60; % Convert seconds to minutes

figure;

subplot(3, 1, 1);
plot(tMin, XYZ(:, 1));
xlabel('Time (minutes)');
ylabel('Measured X-axis Bias');
title('Bias (X) vs Time');

subplot(3, 1, 2);
plot(tMin, XYZ(:, 2));
xlabel('Time (minutes)');
ylabel('Measured Y-axis Bias');
title('Bias (Y) vs Time');

subplot(3, 1, 3);
plot(tMin, XYZ(:, 3));
xlabel('Time (minutes)');
ylabel('Measured Z-axis Bias');
title('Bias (Z) vs Time');


% Time vector (assuming 6-second intervals)
t = 0:6:(size(XYZ, 1)-1)*6;
% Loop through data
for i = 2:size(XYZ, 1)
    % Calculate change in angle using angular rate (gyroscope data)
    deltaAngle = XYZ(i, :) - XYZ(i-1, :);
    
    % Integrate angles
    currentAngles = currentAngles + deltaAngle;
    integratedAngles(i, :) = currentAngles;
end

% Plot integrated angles
figure;
subplot(3, 1, 1);
plot(t, integratedAngles(:, 1));
xlabel('Time (seconds)');
ylabel('Integrated Angle (X)');
title('Integrated Angle (X) vs. Time');

subplot(3, 1, 2);
plot(t, integratedAngles(:, 2));
xlabel('Time (seconds)');
ylabel('Integrated Angle (Y)');
title('Integrated Angle (Y) vs. Time');

subplot(3, 1, 3);
plot(t, integratedAngles(:, 3));
xlabel('Time (seconds)');
ylabel('Integrated Angle (Z)');
title('Integrated Angle (Z) vs. Time');

% Scatter stuff
[Atilde,Btilde] = CalibrateEllipsoidData3D(X,Y,Z,20,0);
[Xcorr,Ycorr,Zcorr] = CorrectEllipsoidData3D(X,Y,Z,Atilde,Btilde);

% Plot in 3D
scatter3(Xcorr, Ycorr, Zcorr);
xlabel('X');
ylabel('Y');
zlabel('Z');
title('Scatter Plot of XYZ Gyroscope Bias');
